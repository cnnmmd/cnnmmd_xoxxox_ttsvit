FROM ubuntu:22.04

ENV OPTAPT=""
#ENV OPTAPT="-o Acquire::AllowInsecureRepositories=true -o Acquire::AllowDowngradeToInsecureRepositories=true"
COPY cnsver.txt .
RUN \
  apt-get ${OPTAPT} -y update && \
  apt-get ${OPTAPT} -y upgrade && \
  apt-get ${OPTAPT} -y install python3 python3-pip python-is-python3 && \
  rm -rf /var/lib/apt/lists/*
RUN ARC=$(uname -m) && \
  if test "${ARC}" = 'x86_64'; \
  then \
    pip3 install --no-cache-dir -c cnsver.txt torch --index-url https://download.pytorch.org/whl/cpu; \
  else \
    pip3 install --no-cache-dir -c cnsver.txt torch; \
  fi
RUN pip3 install --no-cache-dir -c cnsver.txt style-bert-vits2 aiohttp
